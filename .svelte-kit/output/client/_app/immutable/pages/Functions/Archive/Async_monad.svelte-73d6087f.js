import{S as Ze,i as $e,s as ge,l as f,r as n,a as u,m as p,n as c,u as i,h as t,c as m,q as De,p as ze,b as r,G as a,Q as Ge,v as X,M as et,N as Qe,T as tt,o as st,V as Xe}from"../../../chunks/index-cac77216.js";import{f as Ye}from"../../../chunks/index-54fd7bcd.js";function rt(o){let v,w,T,d,y,k,H,W,C,M,D,N,_,G,K,P,l,h,b,ce,Y,Z,R,ve,$,j,g,E,de,ee,ke,te,he,se,q,we,re,I,ye,oe,A,be,ne,F,Ee,ie,B,_e,ae,x,Se,le,L,Te,fe,O,Ce,pe,J,Pe,ue,U,We,me,V,Ke,S,He,Ne;return{c(){v=f("div"),w=f("br"),T=n(`\r
  Two Asynchronous Functions`),y=u(),k=f("h3"),H=n("Enter the upper limit for a pseudo-random number:"),W=u(),C=f("input"),M=u(),D=f("br"),N=u(),_=f("p"),G=n("The number to evaluate: "),K=n(o[0]),P=u(),l=f("p"),h=n("The prime factors of "),b=n(o[0]),ce=n(" are: "),Y=n(o[1]),Z=u(),R=f("h3"),ve=n("Enter a number to see its prime decomposition:"),$=u(),j=f("input"),g=u(),E=f("p"),de=n("The prime factors of "),ee=n(o[0]),ke=n(" are "),te=n(o[1]),he=n("."),se=n(`\r
Here's how the script begins:\r
`),q=f("pre"),we=n(o[7]),re=u(),I=f("p"),ye=n(`The work is done in a single function named "start" placed in "onMount."  Here's the code:`),oe=u(),A=f("pre"),be=n(o[4]),ne=u(),F=f("p"),Ee=n("Here's the HTML:"),ie=u(),B=f("pre"),_e=n(o[8]),ae=u(),x=f("p"),Se=n("The code isn't annotated, but the key to understanding it is that socket3 returns a pseudo-random number and socket2 returns the prime factors of the integer it receives. The purpose of this page is to show one way of using WebSockets in SvelteKit."),le=u(),L=f("p"),Te=n(`The WebSocket servers run on a droplet separate from the droplet hosting schalk.net. They're on a droplet that services traffic destined for schalk.site. Connections to the servers can be established with, for example, "var sock = new WebSocket('wss://schalk.site')". It's striking how fast WebSockets traffic moves between Digitalocean droplets on the East Coast.`),fe=u(),O=f("p"),Ce=n("Here's the code for the random number server:"),pe=u(),J=f("pre"),Pe=n(o[5]),ue=u(),U=f("p"),We=n("And here's the code for the prime decomposition server:"),me=u(),V=f("pre"),Ke=n(o[6]),this.h()},l(e){v=p(e,"DIV",{style:!0});var s=c(v);w=p(s,"BR",{}),T=i(s,`\r
  Two Asynchronous Functions`),s.forEach(t),y=m(e),k=p(e,"H3",{});var Re=c(k);H=i(Re,"Enter the upper limit for a pseudo-random number:"),Re.forEach(t),W=m(e),C=p(e,"INPUT",{type:!0}),M=m(e),D=p(e,"BR",{}),N=m(e),_=p(e,"P",{});var Me=c(_);G=i(Me,"The number to evaluate: "),K=i(Me,o[0]),Me.forEach(t),P=m(e),l=p(e,"P",{});var Q=c(l);h=i(Q,"The prime factors of "),b=i(Q,o[0]),ce=i(Q," are: "),Y=i(Q,o[1]),Q.forEach(t),Z=m(e),R=p(e,"H3",{});var je=c(R);ve=i(je,"Enter a number to see its prime decomposition:"),je.forEach(t),$=m(e),j=p(e,"INPUT",{type:!0}),g=m(e),E=p(e,"P",{});var z=c(E);de=i(z,"The prime factors of "),ee=i(z,o[0]),ke=i(z," are "),te=i(z,o[1]),he=i(z,"."),z.forEach(t),se=i(e,`\r
Here's how the script begins:\r
`),q=p(e,"PRE",{});var qe=c(q);we=i(qe,o[7]),qe.forEach(t),re=m(e),I=p(e,"P",{});var Ie=c(I);ye=i(Ie,`The work is done in a single function named "start" placed in "onMount."  Here's the code:`),Ie.forEach(t),oe=m(e),A=p(e,"PRE",{});var Ae=c(A);be=i(Ae,o[4]),Ae.forEach(t),ne=m(e),F=p(e,"P",{});var Fe=c(F);Ee=i(Fe,"Here's the HTML:"),Fe.forEach(t),ie=m(e),B=p(e,"PRE",{});var Be=c(B);_e=i(Be,o[8]),Be.forEach(t),ae=m(e),x=p(e,"P",{});var xe=c(x);Se=i(xe,"The code isn't annotated, but the key to understanding it is that socket3 returns a pseudo-random number and socket2 returns the prime factors of the integer it receives. The purpose of this page is to show one way of using WebSockets in SvelteKit."),xe.forEach(t),le=m(e),L=p(e,"P",{});var Le=c(L);Te=i(Le,`The WebSocket servers run on a droplet separate from the droplet hosting schalk.net. They're on a droplet that services traffic destined for schalk.site. Connections to the servers can be established with, for example, "var sock = new WebSocket('wss://schalk.site')". It's striking how fast WebSockets traffic moves between Digitalocean droplets on the East Coast.`),Le.forEach(t),fe=m(e),O=p(e,"P",{});var Oe=c(O);Ce=i(Oe,"Here's the code for the random number server:"),Oe.forEach(t),pe=m(e),J=p(e,"PRE",{});var Je=c(J);Pe=i(Je,o[5]),Je.forEach(t),ue=m(e),U=p(e,"P",{});var Ue=c(U);We=i(Ue,"And here's the code for the prime decomposition server:"),Ue.forEach(t),me=m(e),V=p(e,"PRE",{});var Ve=c(V);Ke=i(Ve,o[6]),Ve.forEach(t),this.h()},h(){De(v,"font-family","Times New Roman"),De(v,"text-align","center"),De(v,"font-size","38px"),ze(C,"type","text"),ze(j,"type","text")},m(e,s){r(e,v,s),a(v,w),a(v,T),r(e,y,s),r(e,k,s),a(k,H),r(e,W,s),r(e,C,s),r(e,M,s),r(e,D,s),r(e,N,s),r(e,_,s),a(_,G),a(_,K),r(e,P,s),r(e,l,s),a(l,h),a(l,b),a(l,ce),a(l,Y),r(e,Z,s),r(e,R,s),a(R,ve),r(e,$,s),r(e,j,s),r(e,g,s),r(e,E,s),a(E,de),a(E,ee),a(E,ke),a(E,te),a(E,he),r(e,se,s),r(e,q,s),a(q,we),r(e,re,s),r(e,I,s),a(I,ye),r(e,oe,s),r(e,A,s),a(A,be),r(e,ne,s),r(e,F,s),a(F,Ee),r(e,ie,s),r(e,B,s),a(B,_e),r(e,ae,s),r(e,x,s),a(x,Se),r(e,le,s),r(e,L,s),a(L,Te),r(e,fe,s),r(e,O,s),a(O,Ce),r(e,pe,s),r(e,J,s),a(J,Pe),r(e,ue,s),r(e,U,s),a(U,We),r(e,me,s),r(e,V,s),a(V,Ke),S=!0,He||(Ne=[Ge(C,"keydown",function(){Xe(o[2])&&o[2].apply(this,arguments)}),Ge(j,"keydown",function(){Xe(o[3])&&o[3].apply(this,arguments)})],He=!0)},p(e,[s]){o=e,(!S||s&1)&&X(K,o[0]),(!S||s&1)&&X(b,o[0]),(!S||s&2)&&X(Y,o[1]),(!S||s&1)&&X(ee,o[0]),(!S||s&2)&&X(te,o[1])},i(e){S||(et(()=>{d||(d=Qe(v,Ye,{},!0)),d.run(1)}),S=!0)},o(e){d||(d=Qe(v,Ye,{},!1)),d.run(0),S=!1},d(e){e&&t(v),e&&d&&d.end(),e&&t(y),e&&t(k),e&&t(W),e&&t(C),e&&t(M),e&&t(D),e&&t(N),e&&t(_),e&&t(P),e&&t(l),e&&t(Z),e&&t(R),e&&t($),e&&t(j),e&&t(g),e&&t(E),e&&t(se),e&&t(q),e&&t(re),e&&t(I),e&&t(oe),e&&t(A),e&&t(ne),e&&t(F),e&&t(ie),e&&t(B),e&&t(ae),e&&t(x),e&&t(le),e&&t(L),e&&t(fe),e&&t(O),e&&t(pe),e&&t(J),e&&t(ue),e&&t(U),e&&t(me),e&&t(V),He=!1,tt(Ne)}}}function ot(o,v,w){let T=1e4,d="Enter the number in the text box to see the result.";var y,k,H,W;st(()=>{y=new WebSocket("wss://schalk3.com:4003"),k=new WebSocket("wss://schalk3.com:4002");function G(){w(2,H=function(l){l.keyCode==13&&(l.target.value,k.send(l.target.value),k.addEventListener("message",function(h){h.data,w(0,T=h.data),y.send(h.data),y.onmessage=function(b){b.data,w(1,d=b.data)}}))});function K(){let P=k.readyState,l=0;l<15&&P!==1?(l+=1,console.log("Repeat i",l),setTimeout(()=>{K()},500)):(l=0,k.send(1e4),k.onmessage=function(h){h.data,w(0,T=h.data),y.send(h.data),y.onmessage=function(b){b.data,w(1,d=b.data)}})}K(),w(3,W=function(l){l.keyCode!==13?console.log("e.keyCode isn't 'Enter'"):l.keyCode==13&&(y.send(l.target.value),w(0,T=l.target.value),y.onmessage=function(h){w(1,d=h.data)})})}G()});let C=`onMount(() => {
    socket3 = new WebSocket('wss://schalk.site:3003');
    socket2 = new WebSocket('wss://schalk.site:3002');
    function start () {
        handleKeydown1 = function handleKeydown1 (e) {
            if (e.keyCode == 13) {
                A = e.target.value;
                socket2.send(e.target.value);
                socket2.addEventListener('message', function (e) {
                    B = e.data;
                    D = e.data;
                    socket3.send(e.data);
                    socket3.onmessage = function (e) {
                        C = e.data;
                        E = e.data;
                    }
                });
            };
        };
        var i = 0
        function func ()  {
            let x = socket2.readyState
            let i = 0;
            if (i < 15 && x !== 1) {
                i+=1;
                console.log("Repeat i", i);
                setTimeout(() => {
                    func();
                },500)
            }
            else {
                i = 0;
                socket2.send(10000);
                socket2.onmessage = function(e) {
                    B = e.data;
                    D = e.data;
                    socket3.send(e.data);
                    socket3.onmessage = function (e) {
                        C = e.data;
                        E = e.data;
                    }
                }
            }
        }
        func();
        handleKeydown2 = function handleKeydown2 (e) {
            if (e.keyCode !== 13) {console.log("e.keyCode isn't 'Enter'")}
            else if (e.keyCode == 13) {
                socket3.send(e.target.value);
                D = e.target.value;
                socket3.onmessage = function (e) {
                    E = e.data;
                    B = E;
                };
            };
        };
    }
    start();
});`;var M=`var ws = require('ws');
var https = require('https');
var fs = require('fs');
var j;

function randomInt (num) {
        return Math.floor(Math.random() * num);
}

const server = https.createServer({
  cert: fs.readFileSync('/etc/letsencrypt/live/schalk.site/cert.pem'),
  key: fs.readFileSync('/etc/letsencrypt/live/schalk.site/privkey.pem')
});
const wss = new ws.WebSocketServer({server});
wss.on('connection', function connection(ws) {
ws.on('message', function incoming(message) {
          var number = JSON.parse(message);
          j = randomInt(number);
          ws.send(j);
  });

});

server.listen(3002); `,D=`var ws = require('ws');
var https = require('https');
var fs = require('fs');
var j,k,n,arr,ar;

const server = https.createServer({
  cert: fs.readFileSync('/etc/letsencrypt/live/schalk.site/cert.pem'),
  key: fs.readFileSync('/etc/letsencrypt/live/schalk.site/privkey.pem')
});
const wss = new ws.WebSocketServer({server});

console.log("started web socket server...")

function pNums(n) {
    var store  = [], i, j, primes = [];
    for (let i = 2; i <= n; ++i) {
        if (!store [i]) {
            primes.push(i);
            for (j = i << 1; j <= n; j += i) {
                store[j] = true;
            }
        }
    }
    return primes;
}

function small (primes, v) {
    return primes.slice(0, primes.indexOf(primes.find(e => e > v)));
};

function primeNums (x) {
    return pNums(x);
};

function pfactors (prms, n) {
    var ar = [];
    prms.map(p => {
        while (n/p === Math.floor(n/p)) {
            ar.push(p);
            n = n/p;
        };
    })
    return ar;
}

var   sortFactors = ar => ar.sort(function(x,y) {
    return (x - y);
});

var g = x => {
        console.log("In g. x is", x);
    var primes = primeNums(x);
    return pfactors(primes,x);
}

wss.on('connection', function connection(ws) {
  ws.on('message', function incoming(message) {
    console.log("server2 incoming message is", message);
    var xx = g(message);
    var x = JSON.stringify(xx);
    ws.send(x);
  });
});
server.listen(3003); `,N=`import { onMount } from 'svelte';
let A = 10000;
let B = 10000;
let C = 10000;
let D = 10000;
let E = "Enter the number in the text box to see the result.";
var socket3, socket2, handleKeydown1, handleKeydown2; `,_=`<h3>Enter the upper limit for a pseudo-random number:</h3>
<input type="text" on:keydown={handleKeydown1} />
<br>
<p>The number to evaluate: {D}</p>
<br>
<p>The prime factors of {D} are {E}.</p> `;return[T,d,H,W,C,M,D,N,_]}class at extends Ze{constructor(v){super(),$e(this,v,ot,rt,ge,{})}}export{at as default};
