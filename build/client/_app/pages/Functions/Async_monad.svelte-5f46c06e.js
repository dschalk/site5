import{S as Ze,i as $e,s as ge,e as f,t as n,k as u,c as p,a as c,h as i,d as t,m,f as Re,b as Ge,g as r,G as a,L as Ve,R as Qe,j as X,M as et,N as Xe,T as tt,v as st,O as Ye}from"../../chunks/vendor-a263fa63.js";function rt(o){let v,h,S,d,w,k,H,W,T,M,R,j,E,V,K,C,l,y,P,ce,Y,Z,D,ve,$,N,g,b,de,ee,ke,te,he,se,I,we,re,q,ye,oe,A,be,ne,F,Ee,ie,B,_e,ae,x,Se,le,L,Te,fe,O,Ce,pe,J,Pe,ue,U,We,me,z,Ke,_,He,je;return{c(){v=f("div"),h=f("br"),S=n(`\r
  Two Asynchronous Functions`),w=u(),k=f("h3"),H=n("Enter the upper limit for a pseudo-random number:"),W=u(),T=f("input"),M=u(),R=f("br"),j=u(),E=f("p"),V=n("The number to evaluate: "),K=n(o[0]),C=u(),l=f("p"),y=n("The prime factors of "),P=n(o[0]),ce=n(" are: "),Y=n(o[1]),Z=u(),D=f("h3"),ve=n("Enter a number to see its prime decomposition:"),$=u(),N=f("input"),g=u(),b=f("p"),de=n("The prime factors of "),ee=n(o[0]),ke=n(" are "),te=n(o[1]),he=n("."),se=n(`\r
Here's how the script begins:\r
`),I=f("pre"),we=n(o[7]),re=u(),q=f("p"),ye=n(`The work is done in a single function named "start" placed in "onMount."  Here's the code:`),oe=u(),A=f("pre"),be=n(o[4]),ne=u(),F=f("p"),Ee=n("Here's the HTML:"),ie=u(),B=f("pre"),_e=n(o[8]),ae=u(),x=f("p"),Se=n("The code isn't annotated, but the key to understanding it is that socket3 returns a pseudo-random number and socket2 returns the prime factors of the integer it receives. The purpose of this page is to show one way of using WebSockets in SvelteKit."),le=u(),L=f("p"),Te=n(`The WebSocket servers run on a droplet separate from the droplet hosting schalk.net. They're on a droplet that services traffic destined for schalk.site. Connections to the servers can be established with, for example, "var sock = new WebSocket('wss://schalk.site')". It's striking how fast WebSockets traffic moves between Digitalocean droplets on the East Coast.`),fe=u(),O=f("p"),Ce=n("Here's the code for the random number server:"),pe=u(),J=f("pre"),Pe=n(o[5]),ue=u(),U=f("p"),We=n("And here's the code for the prime decomposition server:"),me=u(),z=f("pre"),Ke=n(o[6]),this.h()},l(e){v=p(e,"DIV",{style:!0});var s=c(v);h=p(s,"BR",{}),S=i(s,`\r
  Two Asynchronous Functions`),s.forEach(t),w=m(e),k=p(e,"H3",{});var De=c(k);H=i(De,"Enter the upper limit for a pseudo-random number:"),De.forEach(t),W=m(e),T=p(e,"INPUT",{type:!0}),M=m(e),R=p(e,"BR",{}),j=m(e),E=p(e,"P",{});var Me=c(E);V=i(Me,"The number to evaluate: "),K=i(Me,o[0]),Me.forEach(t),C=m(e),l=p(e,"P",{});var Q=c(l);y=i(Q,"The prime factors of "),P=i(Q,o[0]),ce=i(Q," are: "),Y=i(Q,o[1]),Q.forEach(t),Z=m(e),D=p(e,"H3",{});var Ne=c(D);ve=i(Ne,"Enter a number to see its prime decomposition:"),Ne.forEach(t),$=m(e),N=p(e,"INPUT",{type:!0}),g=m(e),b=p(e,"P",{});var G=c(b);de=i(G,"The prime factors of "),ee=i(G,o[0]),ke=i(G," are "),te=i(G,o[1]),he=i(G,"."),G.forEach(t),se=i(e,`\r
Here's how the script begins:\r
`),I=p(e,"PRE",{});var Ie=c(I);we=i(Ie,o[7]),Ie.forEach(t),re=m(e),q=p(e,"P",{});var qe=c(q);ye=i(qe,`The work is done in a single function named "start" placed in "onMount."  Here's the code:`),qe.forEach(t),oe=m(e),A=p(e,"PRE",{});var Ae=c(A);be=i(Ae,o[4]),Ae.forEach(t),ne=m(e),F=p(e,"P",{});var Fe=c(F);Ee=i(Fe,"Here's the HTML:"),Fe.forEach(t),ie=m(e),B=p(e,"PRE",{});var Be=c(B);_e=i(Be,o[8]),Be.forEach(t),ae=m(e),x=p(e,"P",{});var xe=c(x);Se=i(xe,"The code isn't annotated, but the key to understanding it is that socket3 returns a pseudo-random number and socket2 returns the prime factors of the integer it receives. The purpose of this page is to show one way of using WebSockets in SvelteKit."),xe.forEach(t),le=m(e),L=p(e,"P",{});var Le=c(L);Te=i(Le,`The WebSocket servers run on a droplet separate from the droplet hosting schalk.net. They're on a droplet that services traffic destined for schalk.site. Connections to the servers can be established with, for example, "var sock = new WebSocket('wss://schalk.site')". It's striking how fast WebSockets traffic moves between Digitalocean droplets on the East Coast.`),Le.forEach(t),fe=m(e),O=p(e,"P",{});var Oe=c(O);Ce=i(Oe,"Here's the code for the random number server:"),Oe.forEach(t),pe=m(e),J=p(e,"PRE",{});var Je=c(J);Pe=i(Je,o[5]),Je.forEach(t),ue=m(e),U=p(e,"P",{});var Ue=c(U);We=i(Ue,"And here's the code for the prime decomposition server:"),Ue.forEach(t),me=m(e),z=p(e,"PRE",{});var ze=c(z);Ke=i(ze,o[6]),ze.forEach(t),this.h()},h(){Re(v,"font-family","Times New Roman"),Re(v,"text-align","center"),Re(v,"font-size","38px"),Ge(T,"type","text"),Ge(N,"type","text")},m(e,s){r(e,v,s),a(v,h),a(v,S),r(e,w,s),r(e,k,s),a(k,H),r(e,W,s),r(e,T,s),r(e,M,s),r(e,R,s),r(e,j,s),r(e,E,s),a(E,V),a(E,K),r(e,C,s),r(e,l,s),a(l,y),a(l,P),a(l,ce),a(l,Y),r(e,Z,s),r(e,D,s),a(D,ve),r(e,$,s),r(e,N,s),r(e,g,s),r(e,b,s),a(b,de),a(b,ee),a(b,ke),a(b,te),a(b,he),r(e,se,s),r(e,I,s),a(I,we),r(e,re,s),r(e,q,s),a(q,ye),r(e,oe,s),r(e,A,s),a(A,be),r(e,ne,s),r(e,F,s),a(F,Ee),r(e,ie,s),r(e,B,s),a(B,_e),r(e,ae,s),r(e,x,s),a(x,Se),r(e,le,s),r(e,L,s),a(L,Te),r(e,fe,s),r(e,O,s),a(O,Ce),r(e,pe,s),r(e,J,s),a(J,Pe),r(e,ue,s),r(e,U,s),a(U,We),r(e,me,s),r(e,z,s),a(z,Ke),_=!0,He||(je=[Ve(T,"keydown",function(){Qe(o[2])&&o[2].apply(this,arguments)}),Ve(N,"keydown",function(){Qe(o[3])&&o[3].apply(this,arguments)})],He=!0)},p(e,[s]){o=e,(!_||s&1)&&X(K,o[0]),(!_||s&1)&&X(P,o[0]),(!_||s&2)&&X(Y,o[1]),(!_||s&1)&&X(ee,o[0]),(!_||s&2)&&X(te,o[1])},i(e){_||(et(()=>{d||(d=Xe(v,Ye,{},!0)),d.run(1)}),_=!0)},o(e){d||(d=Xe(v,Ye,{},!1)),d.run(0),_=!1},d(e){e&&t(v),e&&d&&d.end(),e&&t(w),e&&t(k),e&&t(W),e&&t(T),e&&t(M),e&&t(R),e&&t(j),e&&t(E),e&&t(C),e&&t(l),e&&t(Z),e&&t(D),e&&t($),e&&t(N),e&&t(g),e&&t(b),e&&t(se),e&&t(I),e&&t(re),e&&t(q),e&&t(oe),e&&t(A),e&&t(ne),e&&t(F),e&&t(ie),e&&t(B),e&&t(ae),e&&t(x),e&&t(le),e&&t(L),e&&t(fe),e&&t(O),e&&t(pe),e&&t(J),e&&t(ue),e&&t(U),e&&t(me),e&&t(z),He=!1,tt(je)}}}function ot(o,v,h){let S=1e4,d="Enter the number in the text box to see the result.";var w,k,H,W;st(()=>{w=new WebSocket("wss://schalk.site:3003"),k=new WebSocket("wss://schalk.site:3002");function V(){h(2,H=function(l){l.keyCode==13&&(l.target.value,k.send(l.target.value),k.addEventListener("message",function(y){h(0,S=y.data),w.send(y.data),w.onmessage=function(P){h(1,d=P.data)}}))});function K(){let C=k.readyState,l=0;l<15&&C!==1?(l+=1,console.log("Repeat i",l),setTimeout(()=>{K()},500)):(l=0,k.send(1e4),k.onmessage=function(y){h(0,S=y.data),w.send(y.data),w.onmessage=function(P){h(1,d=P.data)}})}K(),h(3,W=function(l){l.keyCode!==13?console.log("e.keyCode isn't 'Enter'"):l.keyCode==13&&(w.send(l.target.value),h(0,S=l.target.value),w.onmessage=function(y){h(1,d=y.data)})})}V()});let T=`onMount(() => {
    socket3 = new WebSocket('wss://schalk.site:3003');
    socket2 = new WebSocket('wss://schalk.site:3002');
    function start () {
        handleKeydown1 = function handleKeydown1 (e) {
            if (e.keyCode == 13) {
                A = e.target.value;
                socket2.send(e.target.value);
                socket2.addEventListener('message', function (e) {
                    B = e.data;
                    D = e.data;
                    socket3.send(e.data);
                    socket3.onmessage = function (e) {
                        C = e.data;
                        E = e.data;
                    }
                });
            };
        };
        var i = 0
        function func ()  {
            let x = socket2.readyState
            let i = 0;
            if (i < 15 && x !== 1) {
                i+=1;
                console.log("Repeat i", i);
                setTimeout(() => {
                    func();
                },500)
            }
            else {
                i = 0;
                socket2.send(10000);
                socket2.onmessage = function(e) {
                    B = e.data;
                    D = e.data;
                    socket3.send(e.data);
                    socket3.onmessage = function (e) {
                        C = e.data;
                        E = e.data;
                    }
                }
            }
        }
        func();
        handleKeydown2 = function handleKeydown2 (e) {
            if (e.keyCode !== 13) {console.log("e.keyCode isn't 'Enter'")}
            else if (e.keyCode == 13) {
                socket3.send(e.target.value);
                D = e.target.value;
                socket3.onmessage = function (e) {
                    E = e.data;
                    B = E;
                };
            };
        };
    }
    start();
});`;var M=`var ws = require('ws');
var https = require('https');
var fs = require('fs');
var j;

function randomInt (num) {
        return Math.floor(Math.random() * num);
}

const server = https.createServer({
  cert: fs.readFileSync('/etc/letsencrypt/live/schalk.site/cert.pem'),
  key: fs.readFileSync('/etc/letsencrypt/live/schalk.site/privkey.pem')
});
const wss = new ws.WebSocketServer({server});
wss.on('connection', function connection(ws) {
ws.on('message', function incoming(message) {
          var number = JSON.parse(message);
          j = randomInt(number);
          ws.send(j);
  });

});

server.listen(3002); `,R=`var ws = require('ws');
var https = require('https');
var fs = require('fs');
var j,k,n,arr,ar;

const server = https.createServer({
  cert: fs.readFileSync('/etc/letsencrypt/live/schalk.site/cert.pem'),
  key: fs.readFileSync('/etc/letsencrypt/live/schalk.site/privkey.pem')
});
const wss = new ws.WebSocketServer({server});

console.log("started web socket server...")

function pNums(n) {
    var store  = [], i, j, primes = [];
    for (let i = 2; i <= n; ++i) {
        if (!store [i]) {
            primes.push(i);
            for (j = i << 1; j <= n; j += i) {
                store[j] = true;
            }
        }
    }
    return primes;
}

function small (primes, v) {
    return primes.slice(0, primes.indexOf(primes.find(e => e > v)));
};

function primeNums (x) {
    return pNums(x);
};

function pfactors (prms, n) {
    var ar = [];
    prms.map(p => {
        while (n/p === Math.floor(n/p)) {
            ar.push(p);
            n = n/p;
        };
    })
    return ar;
}

var   sortFactors = ar => ar.sort(function(x,y) {
    return (x - y);
});

var g = x => {
        console.log("In g. x is", x);
    var primes = primeNums(x);
    return pfactors(primes,x);
}

wss.on('connection', function connection(ws) {
  ws.on('message', function incoming(message) {
    console.log("server2 incoming message is", message);
    var xx = g(message);
    var x = JSON.stringify(xx);
    ws.send(x);
  });
});
server.listen(3003); `,j=`import { onMount } from 'svelte';
let A = 10000;
let B = 10000;
let C = 10000;
let D = 10000;
let E = "Enter the number in the text box to see the result.";
var socket3, socket2, handleKeydown1, handleKeydown2; `,E=`<h3>Enter the upper limit for a pseudo-random number:</h3>
<input type="text" on:keydown={handleKeydown1} />
<br>
<p>The number to evaluate: {D}</p>
<br>
<p>The prime factors of {D} are {E}.</p> `;return[S,d,H,W,T,M,R,j,E]}class it extends Ze{constructor(v){super();$e(this,v,ot,rt,ge,{})}}export{it as default};
